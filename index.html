<html>

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <title>A Leaflet map!</title>
    <link rel="stylesheet" href="./leaflet/leaflet.css"/>
    <script src="./leaflet/leaflet.js"></script>

    <script src="leaflet-gpx-master/gpx.min.js"></script>
    <script src="./data/roadtrips.js"></script>
    <script src="./data/interrail.js"></script>
    <script src="./data/places_of_residence.js"></script>
    <script src="./data/cities.js"></script>
    <script src="./leaflet-providers/leaflet-providers.js"></script>
    <!--<script src="./keys.js"></script>-->
    <style>
        #map {
            width: 100%;
            height: 100%;
        }
    </style>

</head>

<body>
<!-- To display the map -->
<div id="map"></div>

<script>

    // initialize the map
    var map = L.map('map').setView([45, -40], 3.4);

    // load a tile layer
    //L.tileLayer('http://a.tile.opentopomap.org/{z}/{x}/{y}.png', {
    //    attribution: 'Tiles by <a href="https://opentopomap.org/">OpenTopoMap</a>',
    //    maxZoom: 17,
    //    minZoom: 1
    //}).addTo(map);

    // TODO activate after debugging
    //L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    //    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    //    maxZoom: 18,
    //    id: 'mapbox/streets-v11',
    //    tileSize: 512,
    //    zoomOffset: -1,
    //    accessToken: keys.mapbox
    //}).addTo(map);
    // https://account.mapbox.com/auth/signup/

    L.tileLayer.provider('Stadia.AlidadeSmooth').addTo(map);



    L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.{ext}', {
        attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        subdomains: 'abcd',
        minZoom: 0,
        maxZoom: 18,
        ext: 'png'
    }).addTo(map);

    for (gps_road in roadtrips) {

        let gpx = roadtrips[gps_road];

        let g = new L.GPX(gpx, {
            async: true,
            parseElements: ['track'],
            polyline_options: {
                color: '#333',
                weight: 3,
                opacity: 0.6,
            }
        });

        g.on('loaded', function (e) {
            let gpx = e.target,
                name = gpx.get_name(),
                distM = gpx.get_distance(),
                distKm = distM / 1000,
                distKmRnd = distKm.toFixed(1),
                eleGain = gpx.get_elevation_gain().toFixed(0),
                eleLoss = gpx.get_elevation_loss().toFixed(0);
            let info = "Name: " + name + "</br>" +
                "Distance: " + distKmRnd + " km </br>";

            // register popup on click
            gpx.getLayers()[0].bindPopup(info)
        });

        g.addTo(map);
    }

    for (gps_int in interrail) {

        let gpx = interrail[gps_int];

        let g = new L.GPX(gpx, {
            async: true,
            parseElements: ['track'],
            polyline_options: {
                color: 'red',
                weight: 3,
                opacity: 0.6,
            }
        });

        g.on('loaded', function (e) {
            var gpx = e.target,
                name = gpx.get_name(),
                distM = gpx.get_distance(),
                distKm = distM / 1000,
                distKmRnd = distKm.toFixed(1),
                eleGain = gpx.get_elevation_gain().toFixed(0),
                eleLoss = gpx.get_elevation_loss().toFixed(0);
            var info = "Name: " + name + "</br>" +
                "Distance: " + distKmRnd + " km </br>";

            // register popup on click
            gpx.getLayers()[0].bindPopup(info)
        });

        g.addTo(map);
    }

    for (residence in place_of_residence){
        let position = place_of_residence[residence]
        let circle = L.circleMarker([position.Lat, position.Lon], {
            color: '#EDA540',
            //fillOpacity: 0.5,
            //radius: 500
            fillColor: '#EDA540',
            opacity: 0.84,
            //width: "12px",
            //height: "12px",
            radius: 12
        }).addTo(map);
    }

    for (city in cities_visited){
        let position = cities_visited[city];
        let circle = L.circleMarker([position.Lat, position.Lon], {
            color: '#E67700',
            //fillOpacity: 0.5,
            fillColor: '#E67700',
            opacity: 0.84,
            radius: 12
        }).addTo(map);
    }

</script>
</body>
</html>